(function(a,b){a.widget("ui.albumSlider",{options:{startIndex:1,viewportSize:3,focusedHeight:"100%",focusedWidth:"100%",secondTierHeight:"75%",secondTierWidth:"75%",otherTierHeight:"90%",otherTierWidth:"90%",itemSelector:"li",duration:500,startZIndex:500,tierCss:{}},_create:function(){var e=[],d,j=0,f=0,c=a(this.element);e=c.children();a(e).hide();j=e.size();this.focalIndex=Math.floor(j/2);if(j<this.options.viewportSize){this.options.viewportSize=j;}this.attributes=d=new Array(j);var h=Math.ceil((this.options.viewportSize-1)/2);this.leftViewportEdge=this.focalIndex-h;var k=Math.floor((this.options.viewportSize-1)/2);this.rightViewportEdge=this.focalIndex+k;this.calculateSizes(j,k,h,d);this.showViewport(e,d,c);var g=this;g.isLocked=false;a("#"+c.attr("id")+" "+this.options.itemSelector).live("click",function(){if(g.isLocked){return;}var l=a(this);g.isLocked=true;if(a(this)!=e[g.focalIndex]){var m;a.each(e,function(r,q){if(a(q).is(l)){m=r;}});var p=Math.abs(m-g.focalIndex);var o=g.options.duration/p;var n=0;while(p>0){setTimeout(function(){g.animate(e,m,c,o);},n);n+=o;p--;}}setTimeout(function(){g.isLocked=false;},g.options.duration);});},calculateSizes:function(e,f,d,c){if(e>0){c[this.focalIndex]=this.buildAttributeNode(this.options.focusedHeight,this.options.focusedWidth,"focus");}if(f>0){c[this.focalIndex+1]=this.buildAttributeNode(this.options.secondTierHeight,this.options.secondTierWidth,"right",c[this.focalIndex]);}for(i=this.focalIndex+2;i<e;i++){c[i]=this.buildAttributeNode(this.options.otherTierHeight,this.options.otherTierWidth,"right",c[i-1]);}if(d>0){c[this.focalIndex-1]=this.buildAttributeNode(this.options.secondTierHeight,this.options.secondTierWidth,"left",c[this.focalIndex]);}for(i=this.focalIndex-2;i>=0;i--){c[i]=this.buildAttributeNode(this.options.otherTierHeight,this.options.otherTierWidth,"left",c[i+1]);}},showViewport:function(e,d,c){var f=this;a.each(e,function(g,h){if(g>=f.leftViewportEdge&&g<=f.rightViewportEdge){f.assignAttributes(h,d[g]);a(h).show();}else{f.assignAttributes(h,d[f.rightViewportEdge]);a(h).css({width:0});}});},assignAttributes:function(f,e,d,h){var c=e["data-tier"];a(f).attr("data-tier",c);a(f).attr("data-side",e["data-side"]);a(f).css("z-index",e["z-index"]);var g={height:e.height,width:e.width};if(this.options.tierCss[c]){a.extend(g,this.options.tierCss[c]);}if(d){a(f).animate(g,{duration:h,complete:function(){a(f).css({"overflow-x":"","overflow-y":""});}});}else{a(f).css(g);}},buildAttributeNode:function(g,f,j,e){if(typeof f=="number"){f=f+"px";}var d=1;var c=this.options.startZIndex;if(e){d=e["data-tier"]+1;c=e["z-index"]-1;}return{height:this.calculateSize(g,"height",e),width:this.calculateSize(f,"width",e),"data-side":j,"data-tier":d,"z-index":c};},calculateSize:function(e,f,d){if(typeof e=="number"){return e+"px";}else{if(/\%/.exec(e)&&d){var c=this.percentageOfGreaterNode(e,f,d);return c.value+c.unit;}else{return e;}}},percentageOfGreaterNode:function(d,f,c){greaterSize=c[f];var e=(/\%/.exec(greaterSize))?"%":"px";return{value:(parseInt(greaterSize)*parseInt(d)/100),unit:e};},animate:function(e,f,d,h){var j=(f>this.focalIndex)?"right":"left";var g=this.options.viewportSize==e.length;var c=this.rearrangeViewport(e,j);a(c.toHide).addClass("album-slider-hiding").animate({width:"0px"},{direction:j,duration:h,complete:function(){if(g){a(this).remove();}else{a(this).removeClass("album-slider-hiding");}}});if(j=="right"){d.append(a(c.toShow));}else{d.prepend(a(c.toShow));}for(i=this.leftViewportEdge;i<=this.rightViewportEdge;i++){a(e[i]).show();this.assignAttributes(a(e[i]),this.attributes[i],true,h);}},rearrangeViewport:function(g,f){var j=g.slice(0);var k,d,l,h,c,e;if(f=="left"){a.each(j,function(n,m){if(n==g.length-1){g[0]=m;}else{g[n+1]=m;}});c=g[this.leftViewportEdge];h=j[this.rightViewportEdge];e=this.leftViewportEdge;}else{a.each(j,function(n,m){if(n==0){g[g.length-1]=m;}else{g[n-1]=m;}});c=g[this.rightViewportEdge];h=j[this.leftViewportEdge];e=this.rightViewportEdge;}a(h).css("z-index",this.options.startZIndex-g.length);if(this.options.viewportSize==g.length){c=a(h).clone().css({width:0});g[e]=c;}return{toShow:c,toHide:h};}});})(jQuery);
